<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookings - Venue ERP Internal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/internal.css">
</head>
<body>

  <div class="panel-layout">
    <!-- Sidebar Component -->
    <div id="sidebarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header Component -->
      <div id="headerContainer"></div>

      <!-- Page Content -->
      <div class="page-content">
        <div class="container-fluid">

          <!-- Stats Widgets -->
          <div class="widget-grid" id="statsWidgets"></div>

          <!-- Filters & Search -->
          <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body">
              <div class="grid grid-4">
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Status</label>
                  <select class="form-control" id="filterStatus">
                    <option value="">All Status</option>
                    <option value="confirmed">Confirmed</option>
                    <option value="pending">Pending</option>
                    <option value="cancelled">Cancelled</option>
                    <option value="completed">Completed</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Venue</label>
                  <select class="form-control" id="filterVenue">
                    <option value="">All Venues</option>
                    <option>Grand Ballroom</option>
                    <option>Conference Hall</option>
                    <option>Garden Lawn</option>
                    <option>Rooftop Terrace</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Date Range</label>
                  <input type="date" class="form-control" id="filterDate">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="opacity: 0;">Actions</label>
                  <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-primary" style="flex: 1;">
                      <i class="fas fa-filter"></i> Filter
                    </button>
                    <button class="btn btn-secondary">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bookings Table -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">All Bookings (24)</h3>
              <div style="display: flex; gap: 0.75rem;">
                <button class="btn btn-sm btn-secondary">
                  <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-sm btn-primary" onclick="openModal('newBookingModal')">
                  <i class="fas fa-plus"></i> New Booking
                </button>
              </div>
            </div>
            <div class="card-body" style="padding: 0;" id="bookingsTable"></div>
            <div class="card-footer">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="color: var(--gray); font-size: 0.9rem;">
                  Showing 10 of 24 bookings
                </div>
                <div style="display: flex; gap: 0.5rem;">
                  <button class="btn btn-sm btn-secondary">Previous</button>
                  <button class="btn btn-sm btn-primary">1</button>
                  <button class="btn btn-sm btn-secondary">2</button>
                  <button class="btn btn-sm btn-secondary">3</button>
                  <button class="btn btn-sm btn-secondary">Next</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </main>
  </div>


  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="js/roles-config.js"></script>
  <script src="js/components.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/modals-extended.js"></script>
  <script src="js/internal.js"></script>
  <script>
    $(document).ready(async function() {
      // CRITICAL: Check page access first - security fix
      if (!RoleManager.requirePageAccess()) {
        return; // Stop execution if unauthorized
      }


      // ========== LOAD COMPONENTS ==========
      // Components loaded via initializePage()
      await initializePage(
      );

      // Set page info
      PageManager.setTitle('Bookings Management');
      PageManager.setActiveNav('bookings');

      // Set role-based quick actions
      const quickActions = [];
      if (RoleManager.hasPermission('canCreate')) {
        quickActions.push({
          label: 'New Booking',
          icon: 'fas fa-plus',
          class: 'btn-primary',
          onClick: "openModal('newBookingModal')"
        });
      }
      quickActions.push({
        label: 'Calendar View',
        icon: 'fas fa-calendar',
        class: 'btn-secondary',
        onClick: "window.location.href='calendar.html'"
      });
      PageManager.setQuickActions(quickActions);

      // ========== RENDER ROLE-BASED WIDGETS ==========
      const widgets = RoleManager.getDashboardWidgets();
      WidgetBuilder.renderWidgets(widgets, 'statsWidgets');

      // ========== SAMPLE DATA ==========
      const bookingsData = [
        {
          id: 'BK-1001',
          customer: 'John Smith',
          email: 'john@email.com',
          phone: '5551234567',
          venue: 'Grand Ballroom',
          date: '2026-02-25',
          guests: 350,
          amount: 5000,
          status: 'Confirmed',
          payment: 'Paid'
        },
        {
          id: 'BK-1002',
          customer: 'Sarah Johnson',
          email: 'sarah@email.com',
          phone: '5559876543',
          venue: 'Conference Hall',
          date: '2026-03-10',
          guests: 100,
          amount: 1800,
          status: 'Pending',
          payment: 'Partial'
        },
        {
          id: 'BK-1003',
          customer: 'Mike Davis',
          email: 'mike@email.com',
          phone: '5555551111',
          venue: 'Garden Lawn',
          date: '2026-03-15',
          guests: 150,
          amount: 2500,
          status: 'Confirmed',
          payment: 'Paid'
        },
        {
          id: 'BK-1004',
          customer: 'Emily Wilson',
          email: 'emily@email.com',
          phone: '5552223333',
          venue: 'Rooftop Terrace',
          date: '2026-04-01',
          guests: 80,
          amount: 2200,
          status: 'Pending',
          payment: 'Unpaid'
        },
        {
          id: 'BK-1005',
          customer: 'David Brown',
          email: 'david@email.com',
          phone: '5554445555',
          venue: 'Grand Ballroom',
          date: '2026-04-12',
          guests: 400,
          amount: 6500,
          status: 'Confirmed',
          payment: 'Paid'
        },
        {
          id: 'BK-1006',
          customer: 'Lisa Anderson',
          email: 'lisa@email.com',
          phone: '5556667777',
          venue: 'Conference Hall',
          date: '2026-04-18',
          guests: 120,
          amount: 1900,
          status: 'Confirmed',
          payment: 'Partial'
        },
        {
          id: 'BK-1007',
          customer: 'Tom Martinez',
          email: 'tom@email.com',
          phone: '5558889999',
          venue: 'Garden Lawn',
          date: '2026-05-05',
          guests: 200,
          amount: 3000,
          status: 'Pending',
          payment: 'Unpaid'
        },
        {
          id: 'BK-1008',
          customer: 'Jennifer Lee',
          email: 'jennifer@email.com',
          phone: '5551112222',
          venue: 'Rooftop Terrace',
          date: '2026-05-10',
          guests: 90,
          amount: 2400,
          status: 'Confirmed',
          payment: 'Paid'
        },
        {
          id: 'BK-1009',
          customer: 'Robert Taylor',
          email: 'robert@email.com',
          phone: '5553334444',
          venue: 'Grand Ballroom',
          date: '2026-05-22',
          guests: 450,
          amount: 7200,
          status: 'Confirmed',
          payment: 'Paid'
        },
        {
          id: 'BK-1010',
          customer: 'Amanda White',
          email: 'amanda@email.com',
          phone: '5555556666',
          venue: 'Conference Hall',
          date: '2026-06-01',
          guests: 110,
          amount: 1850,
          status: 'Pending',
          payment: 'Unpaid'
        }
      ];

      // ========== RENDER TABLE WITH ROLE-BASED ACTIONS ==========
      const allActions = {
        view: {
          label: 'View',
          icon: 'fas fa-eye',
          class: 'btn-secondary',
          onClick: 'viewBooking'
        },
        edit: {
          label: 'Edit',
          icon: 'fas fa-edit',
          class: 'btn-primary',
          onClick: 'editBooking'
        },
        delete: {
          label: 'Delete',
          icon: 'fas fa-trash',
          class: 'btn-danger',
          onClick: 'deleteBooking'
        },
        checkin: {
          label: 'Check-in',
          icon: 'fas fa-sign-in-alt',
          class: 'btn-success',
          onClick: 'checkinBooking'
        }
      };

      const allowedActions = RoleManager.getTableActions();
      const actions = allowedActions.map(key => allActions[key]).filter(Boolean);

      TableBuilder.render({
        columns: [
          { label: 'Booking ID', field: 'id' },
          { label: 'Customer', field: 'customer' },
          { label: 'Venue', field: 'venue' },
          {
            label: 'Date',
            field: 'date',
            format: (val) => Formatters.date(val)
          },
          { label: 'Guests', field: 'guests' },
          {
            label: 'Amount',
            field: 'amount',
            format: (val) => Formatters.currency(val)
          },
          {
            label: 'Status',
            field: 'status',
            format: (val) => Formatters.badge(val)
          },
          {
            label: 'Payment',
            field: 'payment',
            format: (val) => {
              const paymentMap = {
                'Paid': 'badge-success',
                'Partial': 'badge-warning',
                'Unpaid': 'badge-danger'
              };
              return `<span class="badge ${paymentMap[val]}">${val}</span>`;
            }
          }
        ],
        data: bookingsData,
        actions: actions
      }, 'bookingsTable');

      // Hide export button for front desk
      if (!RoleManager.hasPermission('canExport')) {
        $('.btn-secondary:contains("Export")').hide();
      }

    });

    // ========== ACTION FUNCTIONS ==========
    function viewBooking(id) {
      console.log('View booking:', id);
      showBookingDetail(id);
    }

    function editBooking(id) {
      console.log('Edit booking:', id);
      showSuccessToast('Edit booking feature coming soon');
    }

    function checkinBooking(id) {
      console.log('Check-in booking:', id);
      showCheckinModal(id, 'Customer Name', 'Venue Name', '2026-03-15');
    }

    function deleteBooking(id) {
      confirmAction(
        'Delete Booking',
        `Are you sure you want to delete booking ${id}? This action cannot be undone.`,
        () => {
          console.log('Deleted booking:', id);
          showSuccessToast(`Booking ${id} deleted successfully!`);
        },
        'Delete',
        'btn-danger'
      );
    }
  </script>

</body>
</html>
