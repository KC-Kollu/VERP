<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leads & Enquiries - Venue ERP Internal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/internal.css">
  <style>
    .pipeline-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .pipeline-column {
      background: var(--light);
      border-radius: 8px;
      padding: 1rem;
      min-height: 400px;
    }

    .pipeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border);
    }

    .pipeline-title {
      font-weight: 700;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .pipeline-count {
      background: var(--primary);
      color: white;
      font-size: 0.75rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .lead-card {
      background: white;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .lead-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .lead-card.new {
      border-left-color: var(--warning);
    }

    .lead-card.contacted {
      border-left-color: var(--info);
    }

    .lead-card.quoted {
      border-left-color: var(--primary);
    }

    .lead-card.converted {
      border-left-color: var(--success);
    }

    .lead-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.5rem;
    }

    .lead-name {
      font-weight: 600;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .lead-value {
      background: var(--success);
      color: white;
      font-size: 0.75rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-weight: 600;
    }

    .lead-info {
      color: var(--gray);
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .lead-info i {
      margin-right: 0.25rem;
      width: 14px;
    }

    .lead-date {
      color: var(--gray);
      font-size: 0.75rem;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
    }

    .source-badge {
      display: inline-block;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      margin-top: 0.5rem;
    }

    .source-website {
      background: #DBEAFE;
      color: #1E40AF;
    }

    .source-referral {
      background: #FCE7F3;
      color: #9F1239;
    }

    .source-phone {
      background: #FEF3C7;
      color: #92400E;
    }

    .source-email {
      background: #E0E7FF;
      color: #3730A3;
    }

    .source-walkin {
      background: #D1FAE5;
      color: #065F46;
    }

    .view-toggle {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>

  <div class="panel-layout">
    <!-- Sidebar Component -->
    <div id="sidebarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header Component -->
      <div id="headerContainer"></div>

      <!-- Page Content -->
      <div class="page-content">
        <div class="container-fluid">

          <!-- Stats Widgets -->
          <div class="widget-grid" id="statsWidgets"></div>

          <!-- View Toggle -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div class="view-toggle">
              <button class="btn btn-sm btn-primary active" id="pipelineViewBtn">
                <i class="fas fa-columns"></i> Pipeline View
              </button>
              <button class="btn btn-sm btn-secondary" id="tableViewBtn">
                <i class="fas fa-table"></i> Table View
              </button>
            </div>
            <button class="btn btn-primary" onclick="openModal('newLeadModal')">
              <i class="fas fa-plus"></i> New Lead
            </button>
          </div>

          <!-- Pipeline Board -->
          <div class="pipeline-board" id="pipelineBoard">
            <div class="pipeline-column">
              <div class="pipeline-header">
                <span class="pipeline-title">New Leads</span>
                <span class="pipeline-count" id="countNew">0</span>
              </div>
              <div id="columnNew"></div>
            </div>

            <div class="pipeline-column">
              <div class="pipeline-header">
                <span class="pipeline-title">Contacted</span>
                <span class="pipeline-count" id="countContacted">0</span>
              </div>
              <div id="columnContacted"></div>
            </div>

            <div class="pipeline-column">
              <div class="pipeline-header">
                <span class="pipeline-title">Quoted</span>
                <span class="pipeline-count" id="countQuoted">0</span>
              </div>
              <div id="columnQuoted"></div>
            </div>

            <div class="pipeline-column">
              <div class="pipeline-header">
                <span class="pipeline-title">Converted</span>
                <span class="pipeline-count" id="countConverted">0</span>
              </div>
              <div id="columnConverted"></div>
            </div>
          </div>

          <!-- Table View (Hidden by default) -->
          <div class="card" id="tableView" style="display: none;">
            <div class="card-header">
              <h3 class="card-title">All Leads</h3>
              <div style="display: flex; gap: 0.75rem;">
                <button class="btn btn-sm btn-secondary">
                  <i class="fas fa-filter"></i> Filter
                </button>
                <button class="btn btn-sm btn-secondary">
                  <i class="fas fa-download"></i> Export
                </button>
              </div>
            </div>
            <div class="card-body" style="padding: 0;" id="leadsTableContainer"></div>
          </div>

        </div>
      </div>

    </main>
  </div>


  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="js/roles-config.js"></script>
  <script src="js/components.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/modals-extended.js"></script>
  <script src="js/internal.js"></script>
  <script>
    $(document).ready(async function() {

      // ========== LOAD COMPONENTS ==========
      await ComponentLoader.loadMultiple([
        { name: 'sidebar', target: 'sidebarContainer' },
        { name: 'header', target: 'headerContainer' }
      ]);

      // Set page info
      PageManager.setTitle('Leads & Enquiries');
      PageManager.setActiveNav('leads');

      // Set quick actions
      PageManager.setQuickActions([
        {
          label: 'New Lead',
          icon: 'fas fa-plus',
          class: 'btn-primary',
          onClick: "openModal('newLeadModal')"
        },
        {
          label: 'Import Leads',
          icon: 'fas fa-upload',
          class: 'btn-secondary',
          onClick: "importLeads()"
        },
        {
          label: 'Email Campaign',
          icon: 'fas fa-envelope',
          class: 'btn-secondary',
          onClick: "emailCampaign()"
        }
      ]);

      // ========== RENDER WIDGETS ==========
      const widgets = [
        {
          label: 'Total Leads',
          value: '87',
          change: '+12 this month',
          icon: 'fas fa-user-plus',
          iconClass: 'primary'
        },
        {
          label: 'Conversion Rate',
          value: '42%',
          change: '+5% from last month',
          icon: 'fas fa-chart-line',
          iconClass: 'success'
        },
        {
          label: 'Avg. Deal Value',
          value: '$3,250',
          change: '+8% from last month',
          icon: 'fas fa-dollar-sign',
          iconClass: 'info'
        },
        {
          label: 'Follow-ups Due',
          value: '14',
          change: '3 overdue',
          icon: 'fas fa-bell',
          iconClass: 'warning'
        }
      ];

      WidgetBuilder.renderWidgets(widgets, 'statsWidgets');

      // ========== SAMPLE LEADS DATA ==========
      const leadsData = [
        {
          id: 'L-501',
          name: 'Alice Brown',
          phone: '5551234567',
          email: 'alice@email.com',
          venue: 'Grand Ballroom',
          eventType: 'Wedding',
          eventDate: '2026-05-15',
          guests: 300,
          budget: 5000,
          status: 'new',
          source: 'website',
          createdAt: '2026-02-10',
          notes: 'Looking for elegant wedding venue'
        },
        {
          id: 'L-502',
          name: 'Bob Taylor',
          phone: '5559876543',
          email: 'bob@company.com',
          venue: 'Conference Hall',
          eventType: 'Corporate',
          eventDate: '2026-04-20',
          guests: 150,
          budget: 3000,
          status: 'contacted',
          source: 'referral',
          createdAt: '2026-02-08',
          notes: 'Annual company retreat'
        },
        {
          id: 'L-503',
          name: 'Carol White',
          phone: '5555551234',
          email: 'carol@email.com',
          venue: 'Garden Lawn',
          eventType: 'Birthday',
          eventDate: '2026-03-25',
          guests: 80,
          budget: 1800,
          status: 'quoted',
          source: 'phone',
          createdAt: '2026-02-05',
          notes: '50th birthday celebration'
        },
        {
          id: 'L-504',
          name: 'David Green',
          phone: '5552223333',
          email: 'david@startup.com',
          venue: 'Rooftop Terrace',
          eventType: 'Product Launch',
          eventDate: '2026-04-10',
          guests: 200,
          budget: 4500,
          status: 'converted',
          source: 'email',
          createdAt: '2026-02-01',
          notes: 'Tech startup product launch'
        },
        {
          id: 'L-505',
          name: 'Emma Wilson',
          phone: '5554445555',
          email: 'emma@email.com',
          venue: 'Grand Ballroom',
          eventType: 'Charity Gala',
          eventDate: '2026-06-01',
          guests: 400,
          budget: 7000,
          status: 'new',
          source: 'walkin',
          createdAt: '2026-02-11',
          notes: 'Non-profit fundraising event'
        },
        {
          id: 'L-506',
          name: 'Frank Martinez',
          phone: '5556667777',
          email: 'frank@email.com',
          venue: 'Conference Hall',
          eventType: 'Seminar',
          eventDate: '2026-03-30',
          guests: 100,
          budget: 2200,
          status: 'contacted',
          source: 'website',
          createdAt: '2026-02-09',
          notes: 'Educational seminar series'
        },
        {
          id: 'L-507',
          name: 'Grace Lee',
          phone: '5558889999',
          email: 'grace@email.com',
          venue: 'Garden Lawn',
          eventType: 'Anniversary',
          eventDate: '2026-05-05',
          guests: 120,
          budget: 2800,
          status: 'quoted',
          source: 'referral',
          createdAt: '2026-02-07',
          notes: '25th wedding anniversary'
        },
        {
          id: 'L-508',
          name: 'Henry Adams',
          phone: '5551112222',
          email: 'henry@company.com',
          venue: 'Rooftop Terrace',
          eventType: 'Team Building',
          eventDate: '2026-04-15',
          guests: 75,
          budget: 1500,
          status: 'new',
          source: 'phone',
          createdAt: '2026-02-10',
          notes: 'Quarterly team outing'
        },
        {
          id: 'L-509',
          name: 'Isabel Chen',
          phone: '5553334444',
          email: 'isabel@email.com',
          venue: 'Grand Ballroom',
          eventType: 'Wedding',
          eventDate: '2026-07-20',
          guests: 350,
          budget: 6500,
          status: 'quoted',
          source: 'email',
          createdAt: '2026-02-06',
          notes: 'Summer wedding, needs full catering'
        },
        {
          id: 'L-510',
          name: 'Jack Robinson',
          phone: '5555556666',
          email: 'jack@startup.com',
          venue: 'Conference Hall',
          eventType: 'Networking',
          eventDate: '2026-03-28',
          guests: 90,
          budget: 2000,
          status: 'contacted',
          source: 'walkin',
          createdAt: '2026-02-08',
          notes: 'Monthly networking mixer'
        },
        {
          id: 'L-511',
          name: 'Kelly Stone',
          phone: '5557778888',
          email: 'kelly@email.com',
          venue: 'Garden Lawn',
          eventType: 'Graduation',
          eventDate: '2026-06-10',
          guests: 100,
          budget: 2500,
          status: 'new',
          source: 'website',
          createdAt: '2026-02-11',
          notes: 'High school graduation party'
        },
        {
          id: 'L-512',
          name: 'Liam Baker',
          phone: '5559990000',
          email: 'liam@company.com',
          venue: 'Rooftop Terrace',
          eventType: 'Corporate',
          eventDate: '2026-04-25',
          guests: 180,
          budget: 4000,
          status: 'converted',
          source: 'referral',
          createdAt: '2026-02-03',
          notes: 'Client appreciation event'
        }
      ];

      renderPipelineBoard(leadsData);
      renderLeadsTable(leadsData);

      // View toggle functionality
      $('#pipelineViewBtn').on('click', function() {
        $(this).removeClass('btn-secondary').addClass('btn-primary active');
        $('#tableViewBtn').removeClass('btn-primary active').addClass('btn-secondary');
        $('#pipelineBoard').show();
        $('#tableView').hide();
      });

      $('#tableViewBtn').on('click', function() {
        $(this).removeClass('btn-secondary').addClass('btn-primary active');
        $('#pipelineViewBtn').removeClass('btn-primary active').addClass('btn-secondary');
        $('#pipelineBoard').hide();
        $('#tableView').show();
      });

    });

    // ========== RENDER PIPELINE BOARD ==========
    function renderPipelineBoard(leads) {
      const stages = {
        new: [],
        contacted: [],
        quoted: [],
        converted: []
      };

      // Group leads by status
      leads.forEach(lead => {
        if (stages[lead.status]) {
          stages[lead.status].push(lead);
        }
      });

      // Update counts
      $('#countNew').text(stages.new.length);
      $('#countContacted').text(stages.contacted.length);
      $('#countQuoted').text(stages.quoted.length);
      $('#countConverted').text(stages.converted.length);

      // Render each column
      Object.keys(stages).forEach(status => {
        const html = stages[status].map(lead => createLeadCard(lead)).join('');
        $(`#column${status.charAt(0).toUpperCase() + status.slice(1)}`).html(html || '<p style="color: var(--gray); text-align: center; font-size: 0.85rem; padding: 1rem;">No leads</p>');
      });
    }

    function createLeadCard(lead) {
      return `
        <div class="lead-card ${lead.status}" onclick="viewLead('${lead.id}')">
          <div class="lead-card-header">
            <div class="lead-name">${lead.name}</div>
            <div class="lead-value">$${lead.budget.toLocaleString()}</div>
          </div>
          <div class="lead-info">
            <i class="fas fa-building"></i> ${lead.venue}
          </div>
          <div class="lead-info">
            <i class="fas fa-calendar"></i> ${new Date(lead.eventDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
          </div>
          <div class="lead-info">
            <i class="fas fa-users"></i> ${lead.guests} guests
          </div>
          <span class="source-badge source-${lead.source}">
            <i class="fas fa-${getSourceIcon(lead.source)}"></i> ${lead.source}
          </span>
          <div class="lead-date">
            <i class="fas fa-clock"></i> ${getRelativeTime(lead.createdAt)}
          </div>
        </div>
      `;
    }

    function getSourceIcon(source) {
      const icons = {
        website: 'globe',
        referral: 'user-friends',
        phone: 'phone',
        email: 'envelope',
        walkin: 'walking'
      };
      return icons[source] || 'question';
    }

    function getRelativeTime(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));

      if (diffDays === 0) return 'Today';
      if (diffDays === 1) return 'Yesterday';
      if (diffDays < 7) return `${diffDays} days ago`;
      if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    // ========== RENDER LEADS TABLE ==========
    function renderLeadsTable(leads) {
      TableBuilder.render({
        columns: [
          { label: 'Lead ID', field: 'id' },
          { label: 'Name', field: 'name' },
          {
            label: 'Phone',
            field: 'phone',
            format: (val) => Formatters.phone(val)
          },
          { label: 'Event Type', field: 'eventType' },
          {
            label: 'Event Date',
            field: 'eventDate',
            format: (val) => Formatters.date(val)
          },
          {
            label: 'Budget',
            field: 'budget',
            format: (val) => Formatters.currency(val)
          },
          {
            label: 'Status',
            field: 'status',
            format: (val) => {
              const statusMap = {
                'new': 'badge-warning',
                'contacted': 'badge-info',
                'quoted': 'badge-primary',
                'converted': 'badge-success'
              };
              return `<span class="badge ${statusMap[val]}">${val}</span>`;
            }
          }
        ],
        data: leads,
        actions: [
          {
            label: 'View',
            icon: 'fas fa-eye',
            class: 'btn-secondary',
            onClick: 'viewLead'
          },
          {
            label: 'Edit',
            icon: 'fas fa-edit',
            class: 'btn-primary',
            onClick: 'editLead'
          },
          {
            label: 'Convert',
            icon: 'fas fa-check',
            class: 'btn-success',
            onClick: 'convertLead'
          }
        ]
      }, 'leadsTableContainer');
    }

    // ========== ACTION FUNCTIONS ==========
    function viewLead(id) {
      console.log('View lead:', id);
      showLeadDetail(id);
    }

    function editLead(id) {
      console.log('Edit lead:', id);
      showSuccessToast('Edit lead feature coming soon');
    }

    function convertLead(id) {
      console.log('Convert lead:', id);
      confirmAction(
        'Convert Lead',
        `Convert lead ${id} to booking?`,
        () => {
          showSuccessToast(`Lead ${id} converted to booking!`);
        },
        'Convert',
        'btn-success'
      );
    }

    function importLeads() {
      showSuccessToast('Import leads feature coming soon');
    }

    function emailCampaign() {
      showSuccessToast('Email campaign feature coming soon');
    }
  </script>

</body>
</html>
