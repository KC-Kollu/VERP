<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoices - Venue ERP Internal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/internal.css">
</head>
<body>

  <div class="panel-layout">
    <!-- Sidebar Component -->
    <div id="sidebarContainer"></div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header Component -->
      <div id="headerContainer"></div>

      <!-- Page Content -->
      <div class="page-content">
        <div class="container-fluid">

          <!-- Stats Widgets -->
          <div class="widget-grid" id="statsWidgets"></div>

          <!-- Filters & Search -->
          <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body">
              <div class="grid grid-4">
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Status</label>
                  <select class="form-control" id="filterStatus">
                    <option value="">All Status</option>
                    <option value="paid">Paid</option>
                    <option value="pending">Pending</option>
                    <option value="overdue">Overdue</option>
                    <option value="partial">Partial</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Date Range</label>
                  <select class="form-control" id="filterDate">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label">Search</label>
                  <input type="text" class="form-control" id="searchInvoice" placeholder="Invoice ID, Customer...">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="opacity: 0;">Actions</label>
                  <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-primary" style="flex: 1;">
                      <i class="fas fa-filter"></i> Filter
                    </button>
                    <button class="btn btn-secondary">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Invoices Table -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">All Invoices (48)</h3>
              <div style="display: flex; gap: 0.75rem;">
                <button class="btn btn-sm btn-secondary">
                  <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-sm btn-primary" onclick="openModal('newInvoiceModal')">
                  <i class="fas fa-plus"></i> New Invoice
                </button>
              </div>
            </div>
            <div class="card-body" style="padding: 0;" id="invoicesTable"></div>
            <div class="card-footer">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="color: var(--gray); font-size: 0.9rem;">
                  Showing 15 of 48 invoices
                </div>
                <div style="display: flex; gap: 0.5rem;">
                  <button class="btn btn-sm btn-secondary">Previous</button>
                  <button class="btn btn-sm btn-primary">1</button>
                  <button class="btn btn-sm btn-secondary">2</button>
                  <button class="btn btn-sm btn-secondary">3</button>
                  <button class="btn btn-sm btn-secondary">4</button>
                  <button class="btn btn-sm btn-secondary">Next</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </main>
  </div>


  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="js/roles-config.js"></script>
  <script src="js/components.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/modals-extended.js"></script>
  <script src="js/internal.js"></script>
  <script>
    $(document).ready(async function() {

      // ========== LOAD COMPONENTS ==========
      await ComponentLoader.loadMultiple([
        { name: 'sidebar', target: 'sidebarContainer' },
        { name: 'header', target: 'headerContainer' }
      ]);

      // Set page info
      PageManager.setTitle('Invoices & Payments');
      PageManager.setActiveNav('invoices');

      // Set quick actions
      PageManager.setQuickActions([
        {
          label: 'New Invoice',
          icon: 'fas fa-plus',
          class: 'btn-primary',
          onClick: "openModal('newInvoiceModal')"
        },
        {
          label: 'Payment Reminder',
          icon: 'fas fa-bell',
          class: 'btn-secondary',
          onClick: "sendReminders()"
        },
        {
          label: 'Financial Report',
          icon: 'fas fa-chart-pie',
          class: 'btn-secondary',
          onClick: "financialReport()"
        }
      ]);

      // ========== RENDER WIDGETS ==========
      const widgets = [
        {
          label: 'Total Invoiced',
          value: '$284,500',
          change: '+18% this month',
          icon: 'fas fa-file-invoice-dollar',
          iconClass: 'primary'
        },
        {
          label: 'Collected',
          value: '$218,300',
          change: '76.7% collection rate',
          icon: 'fas fa-check-circle',
          iconClass: 'success'
        },
        {
          label: 'Outstanding',
          value: '$66,200',
          change: '23.3% pending',
          icon: 'fas fa-clock',
          iconClass: 'warning'
        },
        {
          label: 'Overdue',
          value: '$12,800',
          change: '8 invoices',
          icon: 'fas fa-exclamation-triangle',
          iconClass: 'danger'
        }
      ];

      WidgetBuilder.renderWidgets(widgets, 'statsWidgets');

      // ========== SAMPLE INVOICES DATA ==========
      const invoicesData = [
        {
          id: 'INV-2026-001',
          customer: 'John Smith',
          bookingId: 'BK-1001',
          issueDate: '2026-02-01',
          dueDate: '2026-02-15',
          amount: 5000,
          paid: 5000,
          status: 'Paid',
          paymentMethod: 'Bank Transfer'
        },
        {
          id: 'INV-2026-002',
          customer: 'Sarah Johnson',
          bookingId: 'BK-1002',
          issueDate: '2026-02-03',
          dueDate: '2026-02-17',
          amount: 1800,
          paid: 900,
          status: 'Partial',
          paymentMethod: 'Credit Card'
        },
        {
          id: 'INV-2026-003',
          customer: 'TechCorp Inc.',
          bookingId: 'BK-1003',
          issueDate: '2026-02-05',
          dueDate: '2026-02-19',
          amount: 3500,
          paid: 0,
          status: 'Pending',
          paymentMethod: null
        },
        {
          id: 'INV-2026-004',
          customer: 'Emily Wilson',
          bookingId: 'BK-1004',
          issueDate: '2026-01-20',
          dueDate: '2026-02-03',
          amount: 2200,
          paid: 0,
          status: 'Overdue',
          paymentMethod: null
        },
        {
          id: 'INV-2026-005',
          customer: 'David Brown',
          bookingId: 'BK-1005',
          issueDate: '2026-02-07',
          dueDate: '2026-02-21',
          amount: 6500,
          paid: 6500,
          status: 'Paid',
          paymentMethod: 'Bank Transfer'
        },
        {
          id: 'INV-2026-006',
          customer: 'Lisa Anderson',
          bookingId: 'BK-1006',
          issueDate: '2026-02-08',
          dueDate: '2026-02-22',
          amount: 1900,
          paid: 0,
          status: 'Pending',
          paymentMethod: null
        },
        {
          id: 'INV-2026-007',
          customer: 'Tom Martinez',
          bookingId: 'BK-1007',
          issueDate: '2026-02-09',
          dueDate: '2026-02-23',
          amount: 3000,
          paid: 1500,
          status: 'Partial',
          paymentMethod: 'Credit Card'
        },
        {
          id: 'INV-2026-008',
          customer: 'Jennifer Lee',
          bookingId: 'BK-1008',
          issueDate: '2026-02-10',
          dueDate: '2026-02-24',
          amount: 2400,
          paid: 2400,
          status: 'Paid',
          paymentMethod: 'Cash'
        },
        {
          id: 'INV-2026-009',
          customer: 'Robert Taylor',
          bookingId: 'BK-1009',
          issueDate: '2026-02-11',
          dueDate: '2026-02-25',
          amount: 7200,
          paid: 0,
          status: 'Pending',
          paymentMethod: null
        },
        {
          id: 'INV-2025-155',
          customer: 'Michael Chen',
          bookingId: 'BK-0995',
          issueDate: '2025-12-15',
          dueDate: '2025-12-29',
          amount: 4200,
          paid: 0,
          status: 'Overdue',
          paymentMethod: null
        },
        {
          id: 'INV-2026-010',
          customer: 'Amanda White',
          bookingId: 'BK-1010',
          issueDate: '2026-01-28',
          dueDate: '2026-02-11',
          amount: 1850,
          paid: 1850,
          status: 'Paid',
          paymentMethod: 'Bank Transfer'
        },
        {
          id: 'INV-2026-011',
          customer: 'Christopher Moore',
          bookingId: 'BK-1011',
          issueDate: '2026-02-02',
          dueDate: '2026-02-16',
          amount: 5500,
          paid: 0,
          status: 'Pending',
          paymentMethod: null
        },
        {
          id: 'INV-2026-012',
          customer: 'Jessica Garcia',
          bookingId: 'BK-1012',
          issueDate: '2026-01-25',
          dueDate: '2026-02-08',
          amount: 2800,
          paid: 0,
          status: 'Overdue',
          paymentMethod: null
        },
        {
          id: 'INV-2026-013',
          customer: 'Daniel Rodriguez',
          bookingId: 'BK-1013',
          issueDate: '2026-02-06',
          dueDate: '2026-02-20',
          amount: 3200,
          paid: 3200,
          status: 'Paid',
          paymentMethod: 'Credit Card'
        },
        {
          id: 'INV-2026-014',
          customer: 'Maria Hernandez',
          bookingId: 'BK-1014',
          issueDate: '2026-02-04',
          dueDate: '2026-02-18',
          amount: 4100,
          paid: 2050,
          status: 'Partial',
          paymentMethod: 'Bank Transfer'
        }
      ];

      renderInvoicesTable(invoicesData);

    });

    // ========== RENDER INVOICES TABLE ==========
    function renderInvoicesTable(invoices) {
      TableBuilder.render({
        columns: [
          { label: 'Invoice ID', field: 'id' },
          { label: 'Customer', field: 'customer' },
          { label: 'Booking', field: 'bookingId' },
          {
            label: 'Issue Date',
            field: 'issueDate',
            format: (val) => Formatters.date(val)
          },
          {
            label: 'Due Date',
            field: 'dueDate',
            format: (val) => {
              const date = new Date(val);
              const today = new Date();
              const isOverdue = date < today;
              const formatted = Formatters.date(val);
              return isOverdue ? `<span style="color: var(--danger); font-weight: 600;">${formatted}</span>` : formatted;
            }
          },
          {
            label: 'Amount',
            field: 'amount',
            format: (val) => Formatters.currency(val)
          },
          {
            label: 'Paid',
            field: 'paid',
            format: (val, row) => {
              if (val === row.amount) {
                return `<span style="color: var(--success); font-weight: 600;">${Formatters.currency(val)}</span>`;
              } else if (val > 0) {
                return `<span style="color: var(--warning); font-weight: 600;">${Formatters.currency(val)}</span>`;
              } else {
                return `<span style="color: var(--gray);">${Formatters.currency(val)}</span>`;
              }
            }
          },
          {
            label: 'Status',
            field: 'status',
            format: (val) => {
              const statusMap = {
                'Paid': 'badge-success',
                'Partial': 'badge-warning',
                'Pending': 'badge-info',
                'Overdue': 'badge-danger'
              };
              return `<span class="badge ${statusMap[val]}">${val}</span>`;
            }
          }
        ],
        data: invoices,
        actions: [
          {
            label: 'View',
            icon: 'fas fa-eye',
            class: 'btn-secondary',
            onClick: 'viewInvoice'
          },
          {
            label: 'Download',
            icon: 'fas fa-download',
            class: 'btn-primary',
            onClick: 'downloadInvoice'
          },
          {
            label: 'Record Payment',
            icon: 'fas fa-dollar-sign',
            class: 'btn-success',
            onClick: 'recordPayment'
          }
        ]
      }, 'invoicesTable');
    }

    // ========== ACTION FUNCTIONS ==========
    function viewInvoice(id) {
      console.log('View invoice:', id);
      showInvoiceDetail(id);
    }

    function downloadInvoice(id) {
      console.log('Download invoice:', id);
      showSuccessToast(`Downloading invoice ${id} PDF...`);
    }

    function recordPayment(id) {
      console.log('Record payment for:', id);
      showPaymentModal(id, 5000, 2500);
    }

    function sendReminders() {
      showSuccessToast('Payment reminders sent to overdue customers');
    }

    function financialReport() {
      showSuccessToast('Generating financial report...');
    }
  </script>

</body>
</html>
